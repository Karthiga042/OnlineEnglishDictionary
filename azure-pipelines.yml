trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

variables:
  MAVEN_OPTS: "-Xmx1024m"

steps:
# Setup Java
- task: JavaToolInstaller@0
  inputs:
    versionSpec: '17'       # change Java version as required (e.g., 11, 17)
    jdkArchitectureOption: 'x64'

# Cache Maven dependencies
- task: Cache@2
  inputs:
    key: 'maven | "$(Agent.OS)" | **/pom.xml'
    restoreKeys: |
      maven | "$(Agent.OS)"
    path: $(HOME)/.m2/repository

# Run Maven (tests + package)
- task: Maven@3
  inputs:
    mavenPomFile: 'pom.xml'
    javaHomeOption: 'JDKVersion'
    jdkVersionOption: '1.17'   # matches versionSpec above (1.17 means Java 17)
    publishJUnitResults: true
    testResultsFiles: '**/surefire-reports/TEST-*.xml'
    goals: 'clean test package'
    options: '-B'

# Publish artifact (jar/war) from target folder
- publish: $(System.DefaultWorkingDirectory)/**/target/*.jar
  artifact: drop
